name: Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:
    inputs:
      version:
        description: 'Version to release (e.g., 3.5.5 or 3.6.0-beta1)'
        required: true
        type: string
      create_tag:
        description: 'Create git tag'
        required: true
        type: boolean
        default: true
      prerelease:
        description: 'Mark as prerelease (for beta/alpha versions)'
        required: false
        type: boolean
        default: false

jobs:
  validate-release:
    name: Validate Release
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.version.outputs.version }}
      tag_name: ${{ steps.version.outputs.tag_name }}
      is_prerelease: ${{ steps.version.outputs.is_prerelease }}
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Determine version
      id: version
      run: |
        if [[ "${{ github.event_name }}" == "push" ]]; then
          # Extract version from tag
          VERSION=${GITHUB_REF#refs/tags/v}
          TAG_NAME=$GITHUB_REF_NAME
          
          # Auto-detect prerelease from version string
          if [[ "$VERSION" =~ (alpha|beta|rc|dev|pre) ]]; then
            IS_PRERELEASE="true"
          else
            IS_PRERELEASE="false"
          fi
        else
          # Use manual input
          VERSION="${{ github.event.inputs.version }}"
          TAG_NAME="v$VERSION"
          IS_PRERELEASE="${{ github.event.inputs.prerelease }}"
        fi
        
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        echo "tag_name=$TAG_NAME" >> $GITHUB_OUTPUT
        echo "is_prerelease=$IS_PRERELEASE" >> $GITHUB_OUTPUT
        echo "Release version: $VERSION"
        echo "Tag name: $TAG_NAME"
        echo "Is prerelease: $IS_PRERELEASE"
        
    - name: Validate version format
      run: |
        VERSION="${{ steps.version.outputs.version }}"
        IS_PRERELEASE="${{ steps.version.outputs.is_prerelease }}"
        
        # Allow prerelease formats: X.Y.Z-alpha1, X.Y.Z-beta1, X.Y.Z-rc1, X.Y.Z-dev
        if [[ "$IS_PRERELEASE" == "true" ]]; then
          if [[ ! "$VERSION" =~ ^[0-9]+\.[0-9]+\.[0-9]+-(alpha|beta|rc|dev)[0-9]*$ ]]; then
            echo "âœ— Invalid prerelease version format: $VERSION"
            echo "Expected formats: X.Y.Z-alpha1, X.Y.Z-beta1, X.Y.Z-rc1, X.Y.Z-dev"
            exit 1
          fi
          echo "âœ“ Prerelease version format is valid: $VERSION"
        else
          if [[ ! "$VERSION" =~ ^[0-9]+\.[0-9]+\.[0-9]+$ ]]; then
            echo "âœ— Invalid stable version format: $VERSION (expected: X.Y.Z)"
            exit 1
          fi
          echo "âœ“ Stable version format is valid: $VERSION"
        fi
        
    - name: Check TOC version consistency
      run: |
        VERSION="${{ steps.version.outputs.version }}"
        IS_PRERELEASE="${{ steps.version.outputs.is_prerelease }}"
        TOC_VERSION=$(grep "## Version:" Name2Chat.toc | cut -d' ' -f3)
        
        # For prereleases, allow TOC version to be different (development version)
        if [[ "$IS_PRERELEASE" == "true" ]]; then
          echo "â„¹ï¸ Prerelease detected - skipping TOC version check"
          echo "TOC version: $TOC_VERSION, Release version: $VERSION"
        else
          if [[ "$TOC_VERSION" != "$VERSION" && "$TOC_VERSION" != "@project-version@" ]]; then
            echo "âœ— Version mismatch: TOC ($TOC_VERSION) != Release ($VERSION)"
            echo "For stable releases, TOC version must match or use @project-version@ placeholder"
            exit 1
          fi
          echo "âœ“ TOC version is compatible with release version: $VERSION"
        fi

  create-tag:
    name: Create Git Tag
    runs-on: ubuntu-latest
    needs: validate-release
    if: github.event_name == 'workflow_dispatch' && github.event.inputs.create_tag == 'true'
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Create and push tag
      run: |
        TAG_NAME="${{ needs.validate-release.outputs.tag_name }}"
        VERSION="${{ needs.validate-release.outputs.version }}"
        IS_PRERELEASE="${{ needs.validate-release.outputs.is_prerelease }}"
        
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        
        # Create appropriate tag message
        if [[ "$IS_PRERELEASE" == "true" ]]; then
          git tag -a "$TAG_NAME" -m "Prerelease version $VERSION"
          echo "âœ“ Created prerelease tag: $TAG_NAME"
        else
          git tag -a "$TAG_NAME" -m "Release version $VERSION"
          echo "âœ“ Created release tag: $TAG_NAME"
        fi
        
        git push origin "$TAG_NAME"

  package-addon:
    name: Package Addon
    runs-on: ubuntu-latest
    needs: validate-release
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # Fetch full history for proper changelog generation
        
    - name: Update version in TOC file
      run: |
        VERSION="${{ needs.validate-release.outputs.version }}"
        echo "Updating version placeholder in TOC file to: $VERSION"
        sed -i "s/@project-version@/$VERSION/g" Name2Chat.toc
        
        # Verify the version was updated
        echo "Updated TOC version line:"
        grep "## Version:" Name2Chat.toc
        
    - name: Validate TOC file structure
      run: |
        echo "Validating TOC file structure for BigWigs Packager..."
        
        # Check if required TOC metadata is present
        if ! grep -q "## X-Curse-Project-ID:" Name2Chat.toc; then
          echo "âš ï¸ Missing X-Curse-Project-ID in TOC file"
        fi
        
        if ! grep -q "## X-WoWI-ID:" Name2Chat.toc; then
          echo "âš ï¸ Missing X-WoWI-ID in TOC file"
        fi
        
        if ! grep -q "## X-Wago-ID:" Name2Chat.toc; then
          echo "âš ï¸ Missing X-Wago-ID in TOC file"
        fi
        
        # Validate interface versions
        echo "Checking interface version format..."
        RETAIL_INTERFACE=$(grep "## Interface-Retail:" Name2Chat.toc | cut -d' ' -f3 || grep "## Interface:" Name2Chat.toc | head -1 | cut -d' ' -f3)
        CLASSIC_INTERFACE=$(grep "## Interface-Classic:" Name2Chat.toc | cut -d' ' -f3)
        
        echo "Found interfaces: Retail=$RETAIL_INTERFACE, Classic=$CLASSIC_INTERFACE"
        
    - name: Install luacheck (optional validation)
      run: |
        sudo apt-get update
        sudo apt-get install -y lua5.1 luarocks
        sudo luarocks install luacheck
        
    - name: Run luacheck (non-blocking)
      run: |
        echo "Running luacheck for code quality (non-blocking)..."
        luacheck --no-color --codes Name2Chat.lua || echo "Luacheck found issues, but continuing with build..."
        
    - name: Package with BigWigs Packager
      id: bigwigs_package
      uses: BigWigsMods/packager@v2
      with:
        args: -S  # Create multi-version TOCs automatically
      env:
        CF_API_KEY: ${{ needs.validate-release.outputs.is_prerelease == 'true' && '' || secrets.CF_API_KEY }}
        WAGO_API_TOKEN: ${{ needs.validate-release.outputs.is_prerelease == 'true' && '' || secrets.WAGO_API_TOKEN }}
        WOWI_API_TOKEN: ${{ needs.validate-release.outputs.is_prerelease == 'true' && '' || secrets.WOWI_API_TOKEN }}
        GITHUB_OAUTH: ${{ secrets.GITHUB_TOKEN }}
      continue-on-error: true
        
    - name: Manual package fallback
      if: always()
      id: manual_package
      run: |
        # Check if BigWigs Packager succeeded
        if [[ "${{ steps.bigwigs_package.outcome }}" == "success" ]]; then
          echo "âœ… BigWigs Packager succeeded, skipping manual fallback"
          exit 0
        fi
        
        echo "Creating manual package (BigWigs Packager not successful)..."
        VERSION="${{ needs.validate-release.outputs.version }}"
        IS_PRERELEASE="${{ needs.validate-release.outputs.is_prerelease }}"
        PACKAGE_NAME="Name2Chat-$VERSION"
        
        if [[ "$IS_PRERELEASE" == "true" ]]; then
          echo "â„¹ï¸ Creating prerelease package (manual packaging for prereleases)"
        else
          echo "âš ï¸ BigWigs Packager failed, falling back to manual packaging"
        fi
        
        echo "Creating manual release package: $PACKAGE_NAME"
        
        # Create temporary directory for packaging
        mkdir -p temp_package/Name2Chat
        
        # Copy addon files (version already updated earlier)
        cp Name2Chat.toc temp_package/Name2Chat/
        cp Name2Chat.lua temp_package/Name2Chat/
        cp embeds.xml temp_package/Name2Chat/ 2>/dev/null || echo "No embeds.xml found"
        cp locale.xml temp_package/Name2Chat/ 2>/dev/null || echo "No locale.xml found"
        
        # Copy locale directory if it exists
        if [ -d "lang" ]; then
          cp -r lang temp_package/Name2Chat/
        fi
        
        # Copy documentation
        cp README.md temp_package/Name2Chat/ 2>/dev/null || echo "No README.md found"
        cp LICENSE.md temp_package/Name2Chat/ 2>/dev/null || echo "No LICENSE.md found"
        
        # Create ZIP package
        cd temp_package
        zip -r "../$PACKAGE_NAME.zip" Name2Chat/
        cd ..
        
        # Verify package creation
        if [ -f "$PACKAGE_NAME.zip" ]; then
          echo "âœ… Package created successfully: $PACKAGE_NAME.zip"
          echo "ðŸ“¦ Package contents:"
          unzip -l "$PACKAGE_NAME.zip"
          
          # Store package info for artifact upload
          echo "package_name=$PACKAGE_NAME" >> $GITHUB_ENV
          echo "package_file=$PACKAGE_NAME.zip" >> $GITHUB_ENV
          echo "manual_package_created=true" >> $GITHUB_OUTPUT
        else
          echo "âŒ Failed to create package!"
          exit 1
        fi
        
    - name: Upload manual package artifact
      if: steps.manual_package.outputs.manual_package_created == 'true'
      uses: actions/upload-artifact@v4
      with:
        name: Name2Chat-${{ needs.validate-release.outputs.version }}-manual
        path: "*.zip"
        retention-days: 90
        
    - name: Upload BigWigs package artifact
      if: steps.bigwigs_package.outcome == 'success'
      uses: actions/upload-artifact@v4
      with:
        name: Name2Chat-${{ needs.validate-release.outputs.version }}-bigwigs
        path: ".release/*.zip"
        retention-days: 90

  create-github-release:
    name: Create GitHub Release
    runs-on: ubuntu-latest
    needs: [validate-release, package-addon]
    if: always() && needs.validate-release.result == 'success'
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Download BigWigs package artifact
      id: download_bigwigs
      uses: actions/download-artifact@v4
      with:
        name: Name2Chat-${{ needs.validate-release.outputs.version }}-bigwigs
        path: ./artifacts
      continue-on-error: true
        
    - name: Download manual package artifact
      id: download_manual
      uses: actions/download-artifact@v4
      with:
        name: Name2Chat-${{ needs.validate-release.outputs.version }}-manual
        path: ./artifacts
      continue-on-error: true
        
    - name: Find package files
      id: find_package
      run: |
        echo "Looking for package files in artifacts directory..."
        
        # Check if artifacts directory exists and list contents
        if [ -d "./artifacts" ]; then
          echo "âœ… Artifacts directory found"
          echo "ðŸ“ Artifacts directory contents:"
          ls -la ./artifacts/ || echo "Cannot list artifacts directory"
          
          # Find the actual package file
          PACKAGE_FILE=$(find ./artifacts -name "*.zip" | head -1)
          if [ -n "$PACKAGE_FILE" ]; then
            echo "âœ… Found package file: $PACKAGE_FILE"
            echo "package_file=$PACKAGE_FILE" >> $GITHUB_OUTPUT
            
            # Extract package name for display
            PACKAGE_NAME=$(basename "$PACKAGE_FILE" .zip)
            echo "package_name=$PACKAGE_NAME" >> $GITHUB_OUTPUT
            
            # Show package contents for verification
            echo ""
            echo "ðŸ“¦ Package contents:"
            unzip -l "$PACKAGE_FILE" || echo "Cannot list package contents"
          else
            echo "âŒ No package file found in artifacts directory!"
            echo ""
            echo "Available files in artifacts directory:"
            find ./artifacts -type f || echo "No files found"
            echo ""
            echo "Both BigWigs Packager and manual fallback failed to create packages."
            exit 1
          fi
        else
          echo "âŒ No artifacts directory found!"
          echo "This means both BigWigs and manual artifact uploads failed."
          echo ""
          echo "Download outcomes:"
          echo "- BigWigs download: ${{ steps.download_bigwigs.outcome }}"
          echo "- Manual download: ${{ steps.download_manual.outcome }}"
          echo ""
          echo "Available files in current directory:"
          ls -la . || echo "Cannot list current directory"
          exit 1
        fi
        
    - name: Generate release notes
      id: release_notes
      run: |
        VERSION="${{ needs.validate-release.outputs.version }}"
        IS_PRERELEASE="${{ needs.validate-release.outputs.is_prerelease }}"
        
        # Get previous tag for changelog generation
        PREVIOUS_TAG=$(git tag --sort=-version:refname | grep -v "^${{ needs.validate-release.outputs.tag_name }}$" | head -1)
        
        echo "Generating release notes for version $VERSION"
        echo "Previous tag: $PREVIOUS_TAG"
        
        # Generate changelog from git commits
        if [ -n "$PREVIOUS_TAG" ]; then
          echo "ðŸ“ Generating changelog from $PREVIOUS_TAG to current..."
          
          # Get commits since last tag with better formatting
          COMMITS=$(git log --pretty=format:"- %s (%h)" ${PREVIOUS_TAG}..HEAD --no-merges | head -20)
          
          # Count commits for summary
          COMMIT_COUNT=$(git rev-list --count ${PREVIOUS_TAG}..HEAD --no-merges)
          
          # Get date of previous release
          PREVIOUS_DATE=$(git log -1 --format=%cd --date=short $PREVIOUS_TAG 2>/dev/null || echo "unknown")
        else
          echo "ðŸ“ No previous tag found, this is the first release"
          COMMITS="- Initial release of Name2Chat addon"
          COMMIT_COUNT=1
          PREVIOUS_DATE="N/A"
        fi
        
        # Generate different release notes for prereleases
        if [[ "$IS_PRERELEASE" == "true" ]]; then
          cat > release_notes.md << EOF
        ## ðŸ§ª Name2Chat v$VERSION (Prerelease)
        
        ### âš ï¸ **Prerelease Version - Use with Caution**
        
        This is a **prerelease version** for testing purposes. It may contain bugs or incomplete features.
        
        **Version:** $VERSION  
        **Status:** ðŸ§ª **Testing/Development**  
        **Release Date:** $(date +"%B %d, %Y")  
        **Compatible with:** Retail, Classic Era, Burning Crusade Classic, Wrath Classic, Cataclysm Classic
        
        ### ðŸ“¦ Download & Installation
        1. **âš ï¸ Backup your settings** before installing
        2. Download the \`${{ steps.find_package.outputs.package_name }}.zip\` file below
        3. Extract to your World of Warcraft \`Interface/AddOns/\` directory
        4. Restart World of Warcraft and test thoroughly
        5. Report any issues on [GitHub Issues](https://github.com/gOOvER/Name2Chat/issues)
        
        ### ðŸ”„ What's New in this Prerelease
        
        **Changes since last version** ($COMMIT_COUNT commits):
        
        $COMMITS
        
        ### ðŸ§ª Testing Focus Areas
        - **Multi-version compatibility** (test on different WoW versions)
        - **Chat functionality** in various channels (Guild, Party, Raid, Instance)
        - **Configuration commands** (\`/n2c config\`, \`/n2c name\`)
        - **Name matching** and **command detection** features
        
        ### ðŸ”§ Current Features
        - âœ… Automatically adds your name to chat messages
        - âœ… Multi-version WoW support (Retail + All Classic versions)
        - âœ… Configurable chat types (Guild, Party, Raid, Instance, Custom channels)
        - âœ… Smart command detection (ignores messages starting with !)
        - âœ… Character name matching options
        - âœ… In-game configuration via \`/n2c config\`
        
        ### âš ï¸ **Important Prerelease Notes**
        - **Not recommended for production use** or important raid content
        - **May contain breaking changes** that affect settings
        - **Settings compatibility** with stable versions not guaranteed
        - **Use at your own risk** - backup SavedVariables before testing
        
        ### ðŸ”— Resources & Support
        - **Stable Releases:** [GitHub Releases](https://github.com/gOOvER/Name2Chat/releases)
        - **Bug Reports:** [GitHub Issues](https://github.com/gOOvER/Name2Chat/issues)
        - **Feature Requests:** [GitHub Discussions](https://github.com/gOOvER/Name2Chat/discussions)
        - **Developer Website:** https://www.goover.dev
        
        ### ðŸ“‹ Platform Availability
        - âœ… **GitHub:** Available now (this release)
        - â¸ï¸ **CurseForge:** Manual upload required for prereleases
        - â¸ï¸ **WoWInterface:** Manual upload required for prereleases  
        - â¸ï¸ **Wago:** Manual upload required for prereleases
        
        ---
        
        **âš ï¸ This is a prerelease version** - Not suitable for production use  
        **Full Changelog:** [Compare v$VERSION](https://github.com/gOOvER/Name2Chat/compare/${PREVIOUS_TAG}...v$VERSION)
        EOF
        else
          cat > release_notes.md << EOF
        ## ðŸŽ® Name2Chat v$VERSION
        
        ### Professional WoW Addon - Chat Enhancement
        
        **Version:** $VERSION  
        **Release Date:** $(date +"%B %d, %Y")  
        **Compatible with:** Retail, Classic Era, Burning Crusade Classic, Wrath Classic, Cataclysm Classic
        
        ### ðŸ“¦ Quick Installation
        1. Download the \`${{ steps.find_package.outputs.package_name }}.zip\` file below
        2. Extract to your World of Warcraft \`Interface/AddOns/\` directory:
           - **Retail:** \`_retail_/Interface/AddOns/\`
           - **Classic versions:** \`_classic_era_/Interface/AddOns/\` (or respective classic folder)
        3. Restart World of Warcraft
        4. Configure via \`/n2c config\` in-game
        5. Enjoy enhanced chat functionality!
        
        ### ðŸ†• What's New in v$VERSION
        
        **Changes in this release** ($COMMIT_COUNT updates since $PREVIOUS_TAG):
        
        $COMMITS
        
        ### ðŸ”§ Core Features
        - âœ¨ **Automatic Name Addition** - Adds your character name to chat messages
        - ðŸŒ **Universal WoW Support** - Works on Retail + All Classic versions
        - âš™ï¸ **Smart Configuration** - Configurable chat types (Guild, Party, Raid, Instance, Custom)
        - ðŸ§  **Intelligent Detection** - Ignores commands starting with ! or /
        - ðŸŽ¯ **Name Matching Options** - Flexible character name handling
        - ðŸ“¦ **Professional Packaging** - Built with BigWigs Packager for quality assurance
        
        ### ðŸ“‹ Supported Game Versions
        
        | WoW Version | Interface | Status | Notes |
        |-------------|-----------|--------|-------|
        | **Retail (The War Within)** | 110205 | âœ… Fully Supported | Latest features |
        | **Classic Era** | 11508 | âœ… Fully Supported | Vanilla experience |
        | **Burning Crusade Classic** | 20504 | âœ… Fully Supported | TBC content |
        | **Wrath Classic** | 30403 | âœ… Fully Supported | WotLK raids |
        | **Cataclysm Classic** | 40400 | âœ… Fully Supported | Cata dungeons |
        
        ### ï¿½ Quick Start Commands
        - \`/n2c\` or \`/Name2Chat\` - Toggle addon on/off
        - \`/n2c config\` - Open configuration panel
        - \`/n2c name YourName\` - Set custom display name
        - \`/n2c help\` - Show all available commands
        
        ### ðŸŒ Download Platforms
        
        | Platform | Status | Link |
        |----------|--------|------|
        | **GitHub Releases** | âœ… Available | [Download here](https://github.com/gOOvER/Name2Chat/releases) |
        | **CurseForge** | ðŸ”„ Auto-uploaded | [Project 261826](https://www.curseforge.com/wow/addons/name2chat) |
        | **WoWInterface** | ðŸ”„ Auto-uploaded | [Addon 24357](https://www.wowinterface.com/downloads/info24357-Name2Chat.html) |
        | **Wago Addons** | ðŸ”„ Auto-uploaded | [Project Qb6mWqGP](https://addons.wago.io/addons/name2chat) |
        
        ### ï¿½ï¸ Technical Information
        - **Build System:** Professional CI/CD with GitHub Actions
        - **Code Quality:** Automated luacheck validation
        - **Packaging:** BigWigs Packager v2.4+ for multi-version TOCs
        - **Testing:** Comprehensive validation across all WoW versions
        
        ### ðŸ”— Developer & Support
        - **Website:** https://www.goover.dev
        - **Source Code:** [GitHub Repository](https://github.com/gOOvER/Name2Chat)
        - **Bug Reports:** [GitHub Issues](https://github.com/gOOvER/Name2Chat/issues)
        - **Feature Requests:** [GitHub Discussions](https://github.com/gOOvER/Name2Chat/discussions)
        
        ---
        
        **ðŸš€ Professional Grade:** Built with industry-standard tools and practices  
        **ðŸ“Š Full Changelog:** [Compare v$VERSION](https://github.com/gOOvER/Name2Chat/compare/${PREVIOUS_TAG}...v$VERSION)  
        **â­ Enjoying Name2Chat?** Consider starring the project on GitHub!
        EOF
        fi
        
        echo "release_notes_file=release_notes.md" >> $GITHUB_OUTPUT
        
    - name: Create GitHub Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: ${{ needs.validate-release.outputs.tag_name }}
        name: Name2Chat v${{ needs.validate-release.outputs.version }}
        body_path: release_notes.md
        files: |
          ${{ steps.find_package.outputs.package_file }}
        draft: false
        prerelease: ${{ needs.validate-release.outputs.is_prerelease == 'true' }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  platform-upload-summary:
    name: Platform Upload Summary
    runs-on: ubuntu-latest
    needs: [validate-release, package-addon, create-github-release]
    if: always()
    
    steps:
    - name: Platform upload summary
      run: |
        echo "## ðŸ“¦ Release Summary" >> $GITHUB_STEP_SUMMARY
        echo "**Version:** ${{ needs.validate-release.outputs.version }}" >> $GITHUB_STEP_SUMMARY
        echo "**Tag:** ${{ needs.validate-release.outputs.tag_name }}" >> $GITHUB_STEP_SUMMARY
        echo "**Type:** $([[ "${{ needs.validate-release.outputs.is_prerelease }}" == "true" ]] && echo "ðŸ§ª Prerelease" || echo "âœ… Stable Release")" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Platform Upload Status" >> $GITHUB_STEP_SUMMARY
        echo "| Platform | Status | Notes |" >> $GITHUB_STEP_SUMMARY
        echo "|----------|--------|-------|" >> $GITHUB_STEP_SUMMARY
        echo "| GitHub Releases | âœ… Uploaded | Available for download |" >> $GITHUB_STEP_SUMMARY
        
        # Different upload behavior for prereleases
        if [[ "${{ needs.validate-release.outputs.is_prerelease }}" == "true" ]]; then
          echo "| CurseForge | â¸ï¸ Manual-only | Prereleases not auto-uploaded |" >> $GITHUB_STEP_SUMMARY
          echo "| WoWInterface | â¸ï¸ Manual-only | Prereleases not auto-uploaded |" >> $GITHUB_STEP_SUMMARY
          echo "| Wago | â¸ï¸ Manual-only | Prereleases not auto-uploaded |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### âš ï¸ Prerelease Notes" >> $GITHUB_STEP_SUMMARY
          echo "- Prereleases are **only uploaded to GitHub**" >> $GITHUB_STEP_SUMMARY
          echo "- Manual upload to addon platforms required" >> $GITHUB_STEP_SUMMARY
          echo "- Use for testing and development only" >> $GITHUB_STEP_SUMMARY
        else
          echo "| CurseForge | ðŸ”‘ Auto-upload | Via BigWigs Packager (if API key set) |" >> $GITHUB_STEP_SUMMARY
          echo "| WoWInterface | ðŸ”‘ Auto-upload | Via BigWigs Packager (if API key set) |" >> $GITHUB_STEP_SUMMARY
          echo "| Wago | ðŸ”‘ Auto-upload | Via BigWigs Packager (if API key set) |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ðŸ”§ Setup API Keys" >> $GITHUB_STEP_SUMMARY
          echo "To enable automatic uploads to addon platforms, add these secrets:" >> $GITHUB_STEP_SUMMARY
          echo "- \`CF_API_KEY\` for CurseForge" >> $GITHUB_STEP_SUMMARY
          echo "- \`WOWI_API_TOKEN\` for WoWInterface" >> $GITHUB_STEP_SUMMARY
          echo "- \`WAGO_API_TOKEN\` for Wago" >> $GITHUB_STEP_SUMMARY
        fi
 